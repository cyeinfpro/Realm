{% extends "base.html" %}
{% block content %}
  <div class="grid">
    <section class="card">
      <div class="row">
        <div>
          <h1>控制台</h1>
          <p class="muted">节点管理 & 快速配对码</p>
        </div>
        <button class="btn" onclick="location.reload()">刷新</button>
      </div>

      <h2>添加节点</h2>
      <form class="form" onsubmit="return addNode(event)">
        <label>节点名称</label>
        <input name="name" placeholder="VM-1" required />
        <label>Agent 地址</label>
        <input name="base_url" placeholder="http://1.2.3.4:18700" required />
        <label>Agent Token</label>
        <input name="token" placeholder="xxxxx" required />
        <button class="btn" type="submit">添加</button>
      </form>

      <div class="sep"></div>

      <h2>节点列表</h2>
      {% if nodes|length == 0 %}
        <p class="muted">暂无节点，请先添加。</p>
      {% else %}
        <div class="table">
          <div class="thead">
            <div>名称</div>
            <div>地址</div>
            <div>操作</div>
          </div>
          {% for n in nodes %}
          <div class="trow">
            <div class="mono">{{ n.name }}</div>
            <div class="mono">{{ n.base_url }}</div>
            <div class="actions">
              <a class="btn btn-ghost" href="/node/{{ n.id }}">打开</a>
              <button class="btn btn-danger" onclick="deleteNode({{ n.id }})">删除</button>
            </div>
          </div>
          {% endfor %}
        </div>
      {% endif %}
    </section>

    <section class="card">
      <h1>WSS 配对码</h1>
      <p class="muted">用于同步 WSS Sender 端参数：Host / Path / SNI / Insecure</p>

      <form class="form" onsubmit="return createPair(event)">
        <label>WSS Host（可留空=随机）</label>
        <input name="host" placeholder="www.bing.com" />
        <label>WSS Path（可留空=随机）</label>
        <input name="path" placeholder="/ws" />
        <label>SNI（可留空=与 Host 相同）</label>
        <input name="sni" placeholder="www.bing.com" />
        <label>Insecure (TLS 证书跳过验证)</label>
        <select name="insecure">
          <option value="false" selected>false</option>
          <option value="true">true</option>
        </select>
        <button class="btn" type="submit">生成配对码</button>
      </form>

      <div id="pairResult" class="pair"></div>

      <div class="sep"></div>

      <h2>解析配对码</h2>
      <form class="form" onsubmit="return resolvePair(event)">
        <label>配对码</label>
        <input name="code" placeholder="例如：A1B2C3" required />
        <button class="btn" type="submit">解析</button>
      </form>

      <div id="pairResolve" class="pair"></div>
    </section>
  </div>
{% endblock %}
