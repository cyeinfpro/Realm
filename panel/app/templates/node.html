{% extends "base.html" %}
{% block content %}
  <div class="grid">
    <section class="card">
      <div class="row">
        <div>
          <h1>节点：{{ node.name }}</h1>
          <p class="muted mono">{{ node.base_url }}</p>
        </div>
        <div class="actions">
          <a class="btn btn-ghost" href="/">返回</a>
          <button class="btn" onclick="fetchNodeStatus({{ node.id }})">刷新状态</button>
        </div>
      </div>

      <div id="statusBox" class="pair">
        <p class="muted">点击“刷新状态”获取实时状态。</p>
      </div>

      <div class="sep"></div>

      <h2>规则列表</h2>
      <div id="rulesBox" class="table"></div>

      <div class="sep"></div>

      <h2>新增规则（简化版）</h2>
      <form class="form" onsubmit="return addRule(event, {{ node.id }})">
        <label>本地端口</label>
        <input name="listen_port" placeholder="例如：443" required />
        <label>目标地址（多行，每行 ip:port）</label>
        <textarea name="targets" rows="4" placeholder="10.0.0.1:443\n1.2.3.4:443" required></textarea>
        <label>协议</label>
        <select name="proto">
          <option value="tcp">TCP</option>
          <option value="udp">UDP</option>
          <option value="tcp+udp" selected>TCP+UDP</option>
        </select>
        <button class="btn" type="submit">创建</button>
      </form>
    </section>

    <section class="card">
      <h1>WSS Sender（配对码自动填参）</h1>
      <p class="muted">先输入配对码获取参数，再创建 Sender 规则</p>

      <form class="form" onsubmit="return fillWssFromCode(event)">
        <label>配对码</label>
        <input name="code" placeholder="例如：A1B2C3" required />
        <button class="btn" type="submit">拉取参数</button>
      </form>

      <div id="wssParams" class="pair"></div>
    </section>
  </div>

  <script>
    // auto fetch on load
    window.addEventListener('DOMContentLoaded', () => {
      fetchNodeStatus({{ node.id }});
      fetchNodeRules({{ node.id }});
    });
  </script>
{% endblock %}
