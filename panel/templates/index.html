{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col">
    <h1 class="h1">控制台</h1>
    <p class="muted">集中管理节点接入与转发策略</p>
  </div>
  <div class="col right">
    <button class="btn" type="button" onclick="openAddNodeModal()">接入节点</button>
  </div>
</div>

<div class="grid">
  {% for n in nodes %}
  <div class="card">
    <div class="row">
      <div class="col">
        <div class="h2">{{ n.name or ("节点-" ~ n.id) }}</div>
        <div class="muted">IP：{{ n.display_ip or "-" }}</div>
        <div class="muted">上报：{{ n.last_seen_at or "-" }}{% if n.agent_version %} · {{ n.agent_version }}{% endif %}</div>
      </div>
      <div class="col right">
        <a class="btn-secondary" href="/nodes/{{ n.id }}">打开</a>
      </div>
    </div>
    <div class="meta">
      {% if n.online %}
      <span class="pill ok">在线</span>
      {% else %}
      <span class="pill bad">离线</span>
      {% endif %}
    </div>
  </div>
  {% else %}
  <div class="card">
    <div class="h2">暂无已接入节点</div>
    <p class="muted">请先在目标机器安装 Realm Agent，再回到此处完成接入。</p>
  </div>
  {% endfor %}
</div>

<!-- Add Node Modal -->
<div id="addNodeModal" class="modal" style="display:none;">
  <div class="modal-inner" style="max-width:560px;">
    <div class="row" style="align-items:center;">
      <div class="col"><div class="h2">接入节点</div></div>
      <div class="col right"><button class="btn xs ghost" type="button" onclick="closeAddNodeModal()">关闭</button></div>
    </div>

    <div class="form" style="margin-top:10px;">
      <div class="row" style="gap:12px;">
        <div class="col">
          <label class="label">节点名称（可选）</label>
          <input class="input" id="addNodeName" placeholder="例如：香港-01 / US-Edge">
        </div>
        <div class="col" style="max-width:180px;">
          <label class="label">协议</label>
          <select class="select" id="addNodeScheme">
            <option value="http">http</option>
            <option value="https">https</option>
          </select>
        </div>
      </div>

      <label class="label">IP/域名</label>
      <input class="input" id="addNodeIp" placeholder="例如：1.2.3.4 或 node.example.com">

      <div class="row" style="gap:12px;align-items:center;margin-top:10px;">
        <div class="col">
          <label class="help"><input type="checkbox" id="addNodeVerifyTls" style="transform:translateY(1px);"> 验证 TLS 证书（https 才需要）</label>
        </div>
      </div>

      <div id="addNodeError" class="muted" style="margin-top:8px;color:#ffb3b3;"></div>

      <div class="row" style="gap:10px; justify-content:flex-end; margin-top:14px;">
        <button class="btn xs ghost" type="button" onclick="closeAddNodeModal()">取消</button>
        <button class="btn xs" id="addNodeSubmit" type="button" onclick="createNodeFromModal()">创建并进入</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/app.js"></script>
{% endblock %}
